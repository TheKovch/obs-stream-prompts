
    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Новости для Стрима</title>
        <style>
            body { 
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                margin: 0; 
                background-color: #000000; /* Чисто черный фон */
                color: #e0e0e0; /* Светлый текст */
                display: flex;
                flex-direction: column; 
                justify-content: flex-start; /* Выравнивание содержимого к верху */
                align-items: center; /* Центрирование по горизонтали */
                min-height: 100vh; /* Высота на весь экран */
                width: 100vw; /* Ширина на весь экран */
                padding: 0; /* Убираем padding у body */
                box-sizing: border-box; 
                overflow: hidden; /* Предотвращаем скроллбары */
            }
            .container { 
                max-width: 98vw; 
                width: 98vw;
                height: 98vh; 
                max-height: 98vh;
                background-color: transparent; /* Убираем фон контейнера */
                padding: 5px; /* Минимальный отступ */
                border-radius: 0; /* Без скругления */
                box-shadow: none; /* Без тени */
                border: none; /* Без рамки */
                text-align: left; 
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* Начинаем сверху */
                align-items: stretch; 
                box-sizing: border-box; 
            }
            .article-summary { 
                flex-grow: 1; 
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* Выравниваем содержимое новости к верху */
                border: none; 
                background-color: transparent; 
                padding: 0; /* Без отступа для новости */
                box-shadow: none; 
            }
            .article-summary h2 { 
                color: #00ffff; 
                font-size: 1.6em; 
                text-align: center; 
                margin-top: 0; 
                margin-bottom: 3px; 
                text-shadow: 0 0 8px rgba(0,255,255,0.7); 
                line-height: 1.1; 
            }
            .article-summary p { 
                margin-bottom: 2px; 
                line-height: 1.2; 
                font-size: 1.08em; 
                text-align: center; 
                color: #f0f0f0; 
            }
            /* Специфично для пересказа - попытка уместить в 2 строки, обрезая лишнее */
            .article-summary p.summary {
                max-height: 2.4em; 
                overflow: hidden;
                text-overflow: ellipsis; 
                display: -webkit-box;
                -webkit-line-clamp: 2; 
                -webkit-box-orient: vertical;
                margin-bottom: 6px; 
            }
            .questions-container {
                display: flex;
                flex-wrap: wrap; 
                justify-content: center; 
                gap: 6px; 
                margin-top: 4px; 
            }
            .question-box {
                background-color: rgba(0, 100, 200, 0.2); 
                border-radius: 8px; 
                padding: 7px 12px; 
                color: #ffffff; 
                font-size: 0.96em; 
                line-height: 1.3;
                text-align: center;
                flex-shrink: 0; 
                flex-grow: 1; 
                max-width: 48%; 
                box-sizing: border-box; 
                text-shadow: 0 0 2px rgba(0,255,255,0.5); 
            }
            @media (max-width: 600px) {
                .question-box {
                    max-width: 100%; 
                }
            }

            .article-summary a { 
                color: #00aaff; 
                text-decoration: none; 
            }
            .article-summary a:hover { 
                text-decoration: underline; 
                color: #00ccff;
            }
            .label { 
                font-weight: bold; 
                color: #ffffff; 
                text-shadow: 0 0 2px rgba(255,255,255,0.5); 
            }

            .top-right-controls {
                position: absolute;
                top: 5px; 
                right: 5px; 
                display: flex;
                flex-direction: column;
                align-items: flex-end;
                z-index: 10;
            }
            button {
                padding: 8px 18px; 
                font-size: 0.9em; 
                cursor: pointer;
                background-color: #007bff; 
                color: white;
                border: none;
                border-radius: 5px; 
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                transition: background-color 0.3s ease, transform 0.2s ease;
                margin-bottom: 3px; 
            }
            button:hover {
                background-color: #0056b3;
                transform: translateY(-1px);
            }
            #stop-button {
                background-color: #dc3545; /* Красный цвет для кнопки "Стоп" */
            }
            #stop-button:hover {
                background-color: #bd2130;
            }
            .checkbox-control {
                display: flex;
                align-items: center;
                margin-top: 5px; 
                color: #f0f0f0;
                font-size: 0.85em; 
            }
            .checkbox-control input[type="checkbox"] {
                margin-right: 5px;
                transform: scale(1.1); 
            }
        </style>
    </head>
    <body>
        <div class="top-right-controls">
            <button id="refresh-button">Обновить</button>
            <button id="stop-button">Стоп</button>
            <div class="checkbox-control">
                <input type="checkbox" id="mute-checkbox">
                <label for="mute-checkbox">Отключить звук</label>
            </div>
        </div>

        <div class="container">
            <div id="news-content">
                <!-- Контент новости будет вставлен сюда JavaScript'ом -->
            </div>
        </div>
        
        <!-- Аудио элемент, который будет воспроизводить MP3 -->
        <audio id="news-audio" preload="auto"></audio>

        <script>
            // Текущая временная метка генерации этой страницы
            const currentGenerationTimestamp = 1749137421; 
            const githubPagesBaseUrl = "https://TheKovch.github.io/obs-stream-prompts/";
            const latestUpdateFileUrl = githubPagesBaseUrl + 'latest_update.txt'; // URL файла с последней временной меткой

            const newsData = [{"title": "В хорроре Silent Hill f будет много экшена и сделанный на ближний бой акцент", "link": "https://ixbt.games/news/2025/06/05/v-xorrore-silent-hill-f-budet-mnogo-eksena-i-sdelannyi-na-bliznii-boi-akcent.html", "summary": "Konami на State of Play анонсировала, что в новой Silent Hill f боевая система будет сконцентрирована на сложном ближнем бое с использованием подручных средств. Это решение вызвало вопросы у фанатов, привыкших к атмосфере и головоломкам серии.", "question1": "Silent Hill — это экшен или хоррор?", "question2": "Нужен ли серии такой акцент на боевке?", "audio_url": ""}]; 
            let currentIndex = 0; 
            const newsContentDiv = document.getElementById('news-content');
            const refreshButton = document.getElementById('refresh-button'); 
            const stopButton = document.getElementById('stop-button'); 
            const muteCheckbox = document.getElementById('mute-checkbox'); 
            const newsAudio = document.getElementById('news-audio'); 

            let currentAudioUrl = '';

            function displayNews(index) {
                // Останавливаем текущее воспроизведение перед сменой новости
                stopCurrentAudio();

                newsContentDiv.innerHTML = ''; 
                if (newsData.length === 0) {
                    newsContentDiv.innerHTML = '<p style="text-align: center; color: #aaa;">Не удалось загрузить новости. Нет данных.</p>';
                    refreshButton.style.display = 'none'; 
                    stopButton.style.display = 'none'; 
                    muteCheckbox.style.display = 'none'; 
                    currentAudioUrl = ''; 
                    return;
                }
                
                const item = newsData[0]; 
                const div = document.createElement('div');
                div.className = 'article-summary';
                div.innerHTML = `
                    <h2>${item.title}</h2>
                    <p class="summary">${item.summary}</p>
                    <div class="questions-container">
                        <div class="question-box">${item.question1}</div>
                        <div class="question-box">${item.question2}</div>
                    </div>
                `;
                newsContentDiv.appendChild(div);
                
                refreshButton.style.display = 'block'; 
                stopButton.style.display = 'block'; 
                muteCheckbox.style.display = 'inline-block'; 
                
                // Добавляем параметр для обхода кэша к URL аудио
                currentAudioUrl = item.audio_url + '?v=' + new Date().getTime(); 
                newsAudio.src = currentAudioUrl;
                newsAudio.load(); // Загружаем аудио
                console.log("Источник аудио установлен на:", currentAudioUrl);
            }

            function playCurrentAudio() {
                const urlParams = new URLSearchParams(window.location.search);
                const autoplayAudioParam = urlParams.get('autoplay_audio'); 

                // Если muteCheckbox включен ИЛИ autoplay_audio=false в URL, то не воспроизводим
                if (muteCheckbox.checked || autoplayAudioParam === 'false') {
                    console.log("Воспроизведение аудио пропущено из-за флажка отключения звука или параметра URL.");
                    stopCurrentAudio(); 
                    return;
                }

                if (currentAudioUrl) {
                    // Задержка в 1 секунду для автоматического воспроизведения
                    setTimeout(() => {
                        newsAudio.play().catch(error => {
                            console.error("Ошибка воспроизведения аудио:", error);
                        });
                    }, 1000); // Задержка 1000 мс = 1 секунда
                } else {
                    console.warn("Нет URL аудио для воспроизведения.");
                }
            }

            function stopCurrentAudio() {
                if (newsAudio.paused === false) {
                    newsAudio.pause();
                    newsAudio.currentTime = 0; 
                    console.log("Аудио остановлено.");
                }
            }

            refreshButton.addEventListener('click', () => {
                stopCurrentAudio(); 
                location.reload(); // Ручная перезагрузка
            });

            stopButton.addEventListener('click', stopCurrentAudio);

            muteCheckbox.addEventListener('change', () => {
                if (muteCheckbox.checked) {
                    stopCurrentAudio(); 
                } else {
                    // Опционально: можно добавить playCurrentAudio(); здесь, если нужно автовоспроизведение при снятии мута
                    // playCurrentAudio(); 
                }
            });

            // --- Механизм автоматической проверки обновлений ---
            function checkForUpdates() {
                fetch(latestUpdateFileUrl + '?t=' + new Date().getTime()) // Добавляем кэш-бастер к запросу файла
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Ошибка HTTP! Статус: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(latestTimestamp => {
                        const serverTimestamp = parseInt(latestTimestamp.trim());
                        console.log(`Текущая метка: ${currentGenerationTimestamp}, Серверная метка: ${serverTimestamp}`);

                        if (serverTimestamp > currentGenerationTimestamp) {
                            console.log("Обнаружено новое обновление. Перезагрузка страницы...");
                            location.reload(); 
                        }
                    })
                    .catch(error => {
                        console.error("Ошибка при проверке обновлений:", error);
                    });
            }

            document.addEventListener('DOMContentLoaded', () => {
                displayNews(0); 
                
                // Автоматическое воспроизведение при загрузке страницы
                if (newsData.length > 0) {
                     playCurrentAudio();
                }

                // Запускаем периодическую проверку обновлений каждые 5 секунд
                setInterval(checkForUpdates, 5000); 
            });
        </script>
    </body>
    </html>
    